import json
import logging
import pandas as pd
import numpy as np
import ssl
import time
import urllib3
from pandas import json_normalize


Steam_powered = "http://api.steampowered.com/IDOTA2Match_570/GetTopLiveGame/v1/?key=7BBC5359FE20E6A1329A1530E59B806E&partner=1"

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

def main():
    global Steam_powered
    global logger

    http = urllib3.PoolManager()
    match_id = 6556012655

    logger.info("Mining chunk starting at match ID %d", match_id)
    response = http.request('GET', Steam_powered)

    response_json = json.loads(response.data)
    current_dataframe = json_normalize(response_json)
    myarr = [i for i in current_dataframe['game_list']]
    myarr = np.asarray(myarr).reshape(-1, 1)
    print(myarr)
    print('======')
    players = ''
    hero_id = ''
    radiant = ''
    dire = ''
    player_ch = False
    hero_ch = False
    counter = 0
    for i in myarr:
        if np.char.find(str(i), str(match_id)) > 0:
            print("\nfind of 'tt'", np.char.find(str(i), str(match_id)))
            for j in str(i):
                if j == "'":
                    players = ''
                else:
                    players += str(j)

                if players == 'players':
                    player_ch = True

                if player_ch and players == 'hero_id':
                    hero_ch = True

                if hero_ch and str(j).isdigit():
                    hero_id += str(j)

                if hero_ch and j == '}':
                    hero_id += ', '
                    hero_ch = False

                if j == ']':
                    break

            break
        else:
            counter += 1

    print(myarr[counter])
    print(hero_id)         # Список героев. Radiant и Dire смешанны

    #return results_dataframe


if __name__ == '__main__':
    main()